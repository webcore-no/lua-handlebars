#!/bin/luajit

local luabars = require("lib.luabars")
local cjson = require("cjson.safe")
local err_printf = require("lib.luabars.util").err_printf
local luabarsc = luabars.new()

local template, err = luabarsc:from_file(arg[1])

if not template then
   err_printf("%s", err)
   return 1
end

local file, data

file, err = io.open(arg[2], 'r+')
if not file then
	err_printf(err)
	return
end

data, err = file:read('*all')
if not data then
	err_printf(err)
	return
end

data, err = cjson.decode(data)
if not data then
   err_printf(err)
   return
end
print(template(data))
